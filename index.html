<!DOCTYPE html>
<html lang="en">
<head>
  <!--
    Defines the character encoding for the HTML document.
    UTF-8 covers most characters from all languages and is standard.
  -->
  <meta charset="UTF-8" />

  <!--
    Ensures the page scales correctly on mobile devices.
    width=device-width: use the device’s width as viewport width.
    initial-scale=1.0: don’t zoom in or out by default.
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>SOC Automation Tool</title>
  <style>
    /* Simple styling so the form and results box look clean */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #results {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-top: 1rem;
      white-space: pre-wrap; /* preserve line breaks in error messages */
    }
  </style>
</head>
<body>
  <!--
    This form collects a URL from the user.
    id="urlForm" lets our script find it via document.getElementById()
  -->
  <form id="urlForm">
    <!--
      A text input for entering the URL to scan.
      name="url" so that e.target.url.value pulls its value.
      placeholder gives the user a hint.
    -->
    <input type="text" name="url" placeholder="Enter URL" required />
    <!--
      A submit button. When clicked (or Enter pressed in the input),
      it fires the form's "submit" event.
    -->
    <button type="submit">Scan</button>
  </form>

  <!--
    This div is where we'll insert the scan results or error messages.
  -->
  <div id="results"></div>

  <script>
    // 1) Grab the form element by its ID so we can attach a listener to it.
    const form = document.getElementById("urlForm");

    // 2) Add a listener for when the form is submitted.
    //    The callback is an async function so we can 'await' the fetch.
    form.addEventListener("submit", async function(event) {
      // Prevent the browser’s default form-submit behavior (which reloads the page).
      event.preventDefault();

      // 3) Extract the URL value from the form.
      //    event.target refers to the <form>; .url refers to the input named "url".
      const urlToScan = event.target.url.value;

      // 4) Show a loading message immediately so the user knows something's happening.
      document.getElementById("results").innerText = "Awaiting Results…";

      try {
        // 5) Send the URL to your n8n webhook via HTTP POST.
        //    - method: "POST" because we're sending data.
        //    - headers: inform n8n we’re sending JSON.
        //    - body: the actual JSON string containing { url: "<user input>" }.
        const response = await fetch(
          "https://fjalvarado429.app.n8n.cloud/webhook-test/url-submit",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url: urlToScan }),
          }
        );

        // 6) Read the full text of the response, whether it’s JSON or an error page.
        const text = await response.text();

        // 7) If n8n responded with anything other than a 2xx status, throw an error
        //    so we catch it in the catch block below.
        if (!response.ok) {
          throw new Error(text);
        }

        // 8) Parse the JSON payload into a JavaScript object.
        //    Now we can reference properties like data.page_title, etc.
        const data = JSON.parse(text);

        // 9) Build up some HTML to display the results.
        //    Adjust these fields based on exactly what your workflow returns.
        document.getElementById("results").innerHTML = `
          <p><strong>Title:</strong> ${data.page_title}</p>
          <p><strong>Threat Score:</strong> ${data.verdicts}</p>
          <img src="${data.screenshot_url}" alt="URLScan Screenshot" style="max-width:100%;" />
        `;
      } catch (err) {
        // 10) If anything went wrong—network error, bad JSON, 500 from n8n—we end up here.
        //     err.message contains the raw response text or parsing issue.
        console.error("Webhook error:", err);
        document.getElementById("results").innerText = `Error: ${err.message}`;
      }
    });
  </script>
</body>
</html>
